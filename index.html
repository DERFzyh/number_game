<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数字逼近游戏</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="container">
        <!-- Home View -->
        <div id="view-home" class="view active">
            <header>
                <h1>数字逼近</h1>
                <p>通过加减运算接近目标数字</p>
            </header>
            <div class="home-menu">
                <button class="btn btn-submit btn-home" onclick="startGame()">单人游戏</button>
                <button class="btn btn-op btn-home" style="width: auto; background: #9b59b6;"
                    onclick="openRoomMenu()">对战房间</button>
                <button class="btn btn-op btn-home" style="width: auto; background: #95a5a6;"
                    onclick="openSettings()">设置</button>
            </div>
        </div>

        <!-- Game View -->
        <div id="view-game" class="view">
            <header>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="btn-icon" onclick="goHome()" title="返回主页">🏠</button>
                    <h1>数字逼近</h1>
                    <div style="width: 40px;"></div> <!-- Spacer -->
                </div>
                <div class="target-display">
                    目标数字: <span id="target-num" class="target-number">--</span>
                </div>
                <div class="current-score-display" style="margin-top: 10px; font-size: 1.1rem; font-weight: bold;">
                    当前分数: <span id="current-score" class="score">0.00</span>
                </div>
                <div id="room-info" style="display: none; margin-top: 10px; font-size: 0.9rem;">
                    <span>房间号: <strong id="room-id-display">--</strong></span>
                    <span style="margin-left: 20px;">第 <span id="current-round">1</span> / <span
                            id="total-rounds">1</span> 题</span>
                </div>
            </header>

            <div id="card-pool" class="game-area">
                <!-- Cards will be injected here -->
            </div>

            <div class="controls">
                <button id="btn-add" class="btn btn-op" disabled>+</button>
                <button id="btn-sub" class="btn btn-op" disabled>-</button>
                <button id="btn-mul" class="btn btn-op" disabled>×</button>
                <button id="btn-div" class="btn btn-op" disabled>÷</button>
            </div>

            <div style="margin-bottom: 20px;">
                <button id="btn-decompose" class="btn" style="background: #e67e22; color: white; width: 100px;"
                    disabled>分解</button>
            </div>

            <button id="btn-submit" class="btn btn-submit">提交计算分数</button>

            <!-- 房间排行榜 -->
            <div id="room-leaderboard" style="display: none; margin-top: 30px;">
                <h3 style="margin-bottom: 15px;">房间排行榜</h3>
                <div id="room-leaderboard-content"
                    style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f5f5f5; border-bottom: 2px solid #ddd;">
                                <th style="padding: 8px; text-align: left;">排名</th>
                                <th style="padding: 8px; text-align: left;">玩家</th>
                                <th style="padding: 8px; text-align: right;">进度</th> <!-- 新增：进度列 -->
                                <th style="padding: 8px; text-align: right;">平均分</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>玩家A</td>
                                <td style="text-align: right;">100%</td>
                                <td style="text-align: right;">95.00</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>玩家B</td>
                                <td style="text-align: right;">90%</td>
                                <td style="text-align: right;">90.00</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>玩家C</td>
                                <td style="text-align: right;">85%</td>
                                <td style="text-align: right;">85.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Result Overlay -->
    <div id="result-overlay" class="overlay">
        <div class="modal-card">
            <h2>游戏结束</h2>
            <p>你的平均偏差分数是</p>
            <div id="final-score" class="score">0</div>
            <p id="score-detail" style="color: #666; font-size: 0.9rem;"></p>
            <button id="btn-reset" class="btn btn-reset">再玩一次</button>
            <button class="btn btn-close" onclick="goHome()">返回主页</button>
        </div>
    </div>

    <!-- Room Menu Overlay -->
    <div id="room-menu-overlay" class="overlay">
        <div class="modal-card">
            <h2>对战房间</h2>
            <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
                <button class="btn btn-submit" onclick="openCreateRoom()">创建房间</button>
                <button class="btn" style="background: #3498db; color: white;" onclick="openJoinRoom()">加入房间</button>
                <button class="btn btn-close" onclick="closeRoomMenu()">取消</button>
            </div>
        </div>
    </div>

    <!-- Create Room Overlay -->
    <div id="create-room-overlay" class="overlay">
        <div class="modal-card" style="text-align: left; max-width: 500px;">
            <h2>创建房间</h2>
            <div class="settings-section">
                <h3>玩家名称</h3>
                <input type="text" id="create-room-player-name" placeholder="输入你的名字"
                    style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" value="">
            </div>
            <div class="settings-section">
                <h3>题目数量</h3>
                <input type="number" id="create-room-question-count" value="1" min="1" max="10"
                    style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <details style="margin-top: 15px; border: 1px solid #eee; border-radius: 4px; padding: 10px;">
                <summary style="cursor: pointer; font-weight: bold; color: #666;">高级设置</summary>

                <div class="settings-section" style="margin-top: 10px;">
                    <h3>运算符</h3>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="cr-operator" value="+" checked> +</label>
                        <label><input type="checkbox" name="cr-operator" value="-" checked> -</label>
                        <label><input type="checkbox" name="cr-operator" value="*"> ×</label>
                        <label><input type="checkbox" name="cr-operator" value="/"> ÷</label>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>目标数字范围</h3>
                    <div class="setting-row">
                        <label>最小:</label>
                        <input type="number" id="cr-min-target" value="10" style="width: 60px;">
                    </div>
                    <div class="setting-row">
                        <label>最大:</label>
                        <input type="number" id="cr-max-target" value="100" style="width: 60px;">
                    </div>
                </div>

                <div class="settings-section">
                    <h3>初始数字范围</h3>
                    <div class="setting-row">
                        <label>最小:</label>
                        <input type="number" id="cr-min-pool" value="1" style="width: 60px;">
                    </div>
                    <div class="setting-row">
                        <label>最大:</label>
                        <input type="number" id="cr-max-pool" value="50" style="width: 60px;">
                    </div>
                </div>

                <div class="settings-section">
                    <h3>数字类型</h3>
                    <select id="cr-type" style="width: 100%; padding: 5px;">
                        <option value="integer">整数</option>
                        <option value="decimal1">1位小数</option>
                        <option value="decimal2">2位小数</option>
                        <option value="mul10">整十数</option>
                        <option value="mul100">整百数</option>
                    </select>
                </div>

                <div class="settings-section">
                    <h3>初始数量</h3>
                    <input type="number" id="cr-pool-size" value="5" min="2" max="10" style="width: 100%;">
                </div>
            </details>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-submit" onclick="createRoom()">创建</button>
                <button class="btn btn-close" onclick="closeCreateRoom()">取消</button>
            </div>
        </div>
    </div>

    <!-- Join Room Overlay -->
    <div id="join-room-overlay" class="overlay">
        <div class="modal-card" style="max-width: 400px;">
            <h2>加入房间</h2>
            <div class="settings-section" style="margin-top: 20px;">
                <h3>玩家名称</h3>
                <input type="text" id="join-room-player-name" placeholder="输入你的名字"
                    style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" value="">
            </div>
            <div class="settings-section">
                <h3>房间号</h3>
                <input type="text" id="join-room-id" placeholder="输入6位房间号"
                    style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 1.2rem; text-align: center; letter-spacing: 0.2em;"
                    maxlength="6">
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-submit" onclick="joinRoom()">加入</button>
                <button class="btn btn-close" onclick="closeJoinRoom()">取消</button>
            </div>
        </div>
    </div>

    <!-- Room Settings Overlay -->
    <div id="room-settings-overlay" class="overlay">
        <div class="modal-card" style="text-align: left; max-width: 500px;">
            <h2>房间设置</h2>
            <div id="room-settings-content">
                <!-- 设置内容将由 JavaScript 动态生成 -->
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button id="btn-start-game" class="btn btn-submit" style="display: none;"
                    onclick="startRoomGame()">开始游戏</button>
                <button class="btn btn-close" onclick="closeRoomSettings()">关闭</button>
            </div>
        </div>
    </div>

    <!-- Settings Overlay -->
    <div id="settings-overlay" class="overlay">
        <div class="modal-card" style="text-align: left;">
            <h2>游戏设置</h2>

            <div class="settings-section">
                <h3>运算符</h3>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="operator" value="+" checked> +</label>
                    <label><input type="checkbox" name="operator" value="-" checked> -</label>
                    <label><input type="checkbox" name="operator" value="*"> ×</label>
                    <label><input type="checkbox" name="operator" value="/"> ÷</label>
                </div>
            </div>

            <hr style="margin: 20px 0; border-color: #eee;">

            <!-- 目标数字设置栏目 -->
            <div class="settings-section">
                <h2>目标数字设置</h2>

            <div class="settings-section">
                <h3>目标数字范围</h3>
                <div class="setting-row">
                    <label>最小:</label>
                    <input type="number" id="setting-min-target" value="10" style="width: 60px;">
                </div>
                <div class="setting-row">
                    <label>最大:</label>
                    <input type="number" id="setting-max-target" value="100" style="width: 60px;">
                </div>
            </div>

                <div class="settings-section">
                    <h3>目标数字类型</h3>
                    <select id="setting-target-type" style="width: 100%; padding: 5px;">
                        <option value="integer">整数</option>
                        <option value="decimal1">1位小数</option>
                        <option value="decimal2">2位小数</option>
                        <option value="mul10">整十数</option>
                        <option value="mul100">整百数</option>
                    </select>
                </div>

                <div class="settings-section">
                    <h3>自定义目标数字 (逗号分隔)</h3>
                    <input type="text" id="setting-custom-target-numbers" placeholder="例如: 10,20,30" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
            </div>

            <hr style="margin: 20px 0; border-color: #eee;">

            <!-- 初始数字（卡池）设置栏目 -->
            <div class="settings-section">
                <h2>初始数字（卡池）设置</h2>

            <div class="settings-section">
                <h3>初始数字范围</h3>
                <div class="setting-row">
                    <label>最小:</label>
                    <input type="number" id="setting-min-pool" value="1" style="width: 60px;">
                </div>
                <div class="setting-row">
                    <label>最大:</label>
                    <input type="number" id="setting-max-pool" value="50" style="width: 60px;">
                </div>
            </div>

            <div class="settings-section">
                    <h3>初始数量</h3>
                    <input type="number" id="setting-pool-size" value="5" min="2" max="10" style="width: 100%;">
                </div>

                <div class="settings-section">
                    <h3>初始数字类型</h3>
                    <select id="setting-pool-type" style="width: 100%; padding: 5px;">
                    <option value="integer">整数</option>
                    <option value="decimal1">1位小数</option>
                    <option value="decimal2">2位小数</option>
                    <option value="mul10">整十数</option>
                    <option value="mul100">整百数</option>
                </select>
            </div>

            <div class="settings-section">
                    <h3>自定义卡池数字 (逗号分隔)</h3>
                    <input type="text" id="setting-custom-pool-numbers" placeholder="例如: 1,5,10,25" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
            </div>

            <hr style="margin: 20px 0; border-color: #eee;">

            <div class="settings-section">
                <h3>玩家名称</h3>
                <input type="text" id="setting-player-name" placeholder="输入你的名字"
                    style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <hr style="margin: 20px 0; border-color: #eee;">

            <div class="settings-section">
                <h3>测试模式</h3>
                <label>
                    <input type="checkbox" id="setting-test-mode">
                    开启测试模式 (显示预计算数字)
                </label>
            </div>
            <hr style="margin: 20px 0; border-color: #eee;">

            <div class="settings-section">
                <h3>个性化设置预设</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <select id="setting-presets-select"
                        style="flex-grow: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">选择或保存新预设</option>
                    </select>
                    <button class="btn" style="background: #2ecc71; color: white;"
                        onclick="saveCurrentSettingsAsPreset()">保存</button>
                    <button class="btn" style="background: #3498db; color: white;"
                        onclick="loadSettingsPreset()">加载</button>
                    <button class="btn" style="background: #e74c3c; color: white;"
                        onclick="deleteSettingsPreset()">删除</button>
                </div>
                <input type="text" id="setting-preset-name" placeholder="输入预设名称以保存"
                    style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div style="text-align: center;">
                <button class="btn btn-submit" onclick="closeSettings()">保存并关闭</button>
            </div>
        </div>
    </div>

    <!-- Debug Info Display -->
    <div id="debug-info" style="position: fixed; bottom: 20px; left: 20px; background: rgba(0,0,0,0.7); color: white; padding: 10px; border-radius: 5px; z-index: 1000; display: none;">
        <!-- Content will be injected by JavaScript -->
    </div>

    <script src="script.js"></script>
</body>

</html>